<div class="dashboard">
  <mat-card class="dashboard-header">
    <h3>Choose a date to show reports.</h3>
    <form [formGroup]="form" (ngSubmit)="generateReport()">
      <mat-form-field appearance="fill">
        <input matInput [matDatepicker]="picker" formControlName="date">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <button mat-raised-button color="primary" type="submit" [disabled]="!form.valid">Refresh</button>
    </form>
  </mat-card>

  <div *ngIf="showReport" class="dashboard-content">
    <mat-card *ngIf="learningObjectivePieChartModel" class="chart">
      <mat-card-header>
        <mat-card-title>Students & Their Learning Objectives</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <canvas baseChart
                [data]="learningObjectivePieChartModel.pieChartData"
                [labels]="learningObjectivePieChartModel.pieChartLabels"
                [chartType]="learningObjectivePieChartModel.pieChartType"
                [options]="learningObjectivePieChartModel.pieChartOptions"
                [plugins]="learningObjectivePieChartModel.pieChartPlugins"
                [colors]="learningObjectivePieChartModel.pieChartColors"
                [legend]="learningObjectivePieChartModel.pieChartLegend">
        </canvas>
      </mat-card-content>
    </mat-card>

    <div class="row">
      <mat-card *ngIf="subjectPieChartModel" class="chart">
        <mat-card-header>
          <mat-card-title>Students & Their Subjects</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <canvas baseChart
                  [data]="subjectPieChartModel.pieChartData"
                  [labels]="subjectPieChartModel.pieChartLabels"
                  [chartType]="subjectPieChartModel.pieChartType"
                  [options]="subjectPieChartModel.pieChartOptions"
                  [plugins]="subjectPieChartModel.pieChartPlugins"
                  [colors]="subjectPieChartModel.pieChartColors"
                  [legend]="subjectPieChartModel.pieChartLegend">
          </canvas>
        </mat-card-content>
      </mat-card>
      <mat-card *ngIf="domainPieChartModel" class="chart">
        <mat-card-header>
          <mat-card-title>Number of Students Per Domain</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <canvas baseChart
                  [data]="domainPieChartModel.pieChartData"
                  [labels]="domainPieChartModel.pieChartLabels"
                  [chartType]="domainPieChartModel.pieChartType"
                  [options]="domainPieChartModel.pieChartOptions"
                  [plugins]="domainPieChartModel.pieChartPlugins"
                  [colors]="domainPieChartModel.pieChartColors"
                  [legend]="domainPieChartModel.pieChartLegend">
          </canvas>
        </mat-card-content>
      </mat-card>
    </div>

    <mat-card class="table">
      <mat-card-header>
        <mat-card-title>Top Performing Students</mat-card-title>
        <mat-card-subtitle>Select a subject to see the top (upto 5) performing students.</mat-card-subtitle>
        <mat-form-field appearance="fill">
          <mat-label>Subject</mat-label>
          <mat-select name="subject" ngDefaultControl [(ngModel)]="selectedSubject" (ngModelChange)="getTopPerformingStudents()">
            <mat-option *ngFor="let subject of subjects" [value]="subject" value="one">{{subject}}</mat-option>
          </mat-select>
        </mat-form-field>
      </mat-card-header>

      <mat-card-content>
        <div *ngIf="topPerformingStudents && topPerformingStudents.length > 0">
          <table mat-table [dataSource]="topPerformingStudents">
            <ng-container matColumnDef="userId">
              <th mat-header-cell *matHeaderCellDef>User Id</th>
              <td mat-cell *matCellDef="let element"> {{element.userId}} </td>
            </ng-container>

            <ng-container matColumnDef="progress">
              <th mat-header-cell *matHeaderCellDef>Progress</th>
              <td mat-cell *matCellDef="let element"> {{element.progress}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: tableColumns;"></tr>
          </table>
        </div>
        <div class="no-data" *ngIf="!topPerformingStudents || (topPerformingStudents && topPerformingStudents.length === 0)">
          <h3>There is no top performing students for subject <strong>{{selectedSubject}}</strong>.</h3>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="!showReport" class="no-data">
    <h2>No Data Available.</h2>
  </div>

</div>

