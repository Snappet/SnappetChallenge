var SnappetChallenge;(function(n){var t;(function(t){var i=n.Models.UserCard,r=function(){function t(t,r,u,f,e){var o=this;this.pupils=ko.observableArray([]);this.loading=ko.observable(!1);this.initialized=ko.observable(!1);this.calendar=new n.CalendarVM(t);this.init=function(n){o.initialized(!1);var t=u.getDateFromAlias(n.date);o.calendar.date(t);o.clear();o.loadData(t);o.initialized(!0)};this.clear=function(){o.pupils([])};this.loadData=function(n){var t=r.getFilterForDate(n);o.loading(!0);f.getUsers(t,function(t){n.getTime()===o.calendar.date().getTime()&&o.pupils(t.map(function(n){return new i(n.userId,n.name,n.averageProgress,"/image/"+n.imageId,u.getDateAlias(o.calendar.date()))}))}).always(function(){return o.loading(!1)})};this.calendar.date.subscribe(function(n){if(o.initialized()){var t=u.getDateAlias(n);e.setLocation("#/pupils/"+t)}})}return t}();t.PupilsListVM=r})(t=n.Pupils||(n.Pupils={}))})(SnappetChallenge||(SnappetChallenge={})),function(n){var t;(function(t){var i=function(){function i(){this.init=function(i,r){var u=new t.PupilsListVM(i.dateTimeProvider,i.dateRangeFilterBuilder,i.dateAliasConverter,i.apiClient,r),f=new n.TemplateForm("pupilsList",u),e=new t.PupilDetailsVM(i.dateTimeProvider,i.dateRangeFilterBuilder,i.dateAliasConverter,i.apiClient,r),o=new n.TemplateForm("pupilDetails",e);return new n.CatalogInitResponse("pupils","#/pupils/today","Pupils",[new n.Route("#/pupils/:date",f),new n.Route("#/pupils/:userId/:date",o)])}}return i}();if(t.PupilsCatalog=i,n.catalogRegistry)n.catalogRegistry.registerCatalog(new i);else throw new Error("CatalogRegistry service must be declared before any self registring catalogs.");})(t=n.Pupils||(n.Pupils={}))}(SnappetChallenge||(SnappetChallenge={})),function(n){var t;(function(t){var r=function(){function t(t,r,u,f,e){var o=this;this.userId=ko.observable();this.name=ko.observable();this.imageId=ko.observable();this.averageProgress=ko.observable();this.learningObjectives=ko.observableArray([]);this.loading=ko.observable(!1);this.initialized=ko.observable(!1);this.calendar=new n.CalendarVM(t);this.imageUrl=ko.computed(function(){return o.imageId()?"/image/"+o.imageId():null});this.setData=function(n){o.userId(n.userId);o.name(n.name);o.imageId(n.imageId);o.averageProgress(n.averageProgress);o.learningObjectives(n.learningObjectives.map(function(n){return new i(n)}))};this.init=function(n){console.log("init starts");o.initialized(!1);var t=u.getDateFromAlias(n.date);console.log("setting date");o.calendar.date(t);console.log("clearing data");o.clear();console.log("loading data for",n.userId,t);o.loadData(n.userId,t);o.initialized(!0);console.log("init completes")};this.clear=function(){o.userId(null);o.name(null);o.imageId(null);o.averageProgress(null);o.learningObjectives([])};this.loadData=function(n,t){var i=r.getFilterForDate(t);o.loading(!0);f.getUserDetails(n,i,function(n){console.log("data loaded");t.getTime()===o.calendar.date().getTime()&&(console.log("setting up the data"),o.setData(n))}).always(function(){return o.loading(!1)})};this.calendar.date.subscribe(function(n){if(console.log("date updated",n),o.initialized()&&o.userId()){var t=u.getDateAlias(n);console.log("reloading page");e.setLocation("#/pupils/"+o.userId()+"/"+t)}})}return t}(),i;t.PupilDetailsVM=r;i=function(){function t(t){var i=this;this.name=ko.observable();this.domain=ko.observable();this.subject=ko.observable();this.overallProgress=ko.observable();this.answers=ko.observableArray([]);this.expanded=ko.observable(!1);this.setData=function(n){i.name(n.name);i.domain(n.domain);i.subject(n.subject);i.overallProgress(n.overallProgress);i.answers(n.answers)};this.formattedSubmitTime=function(t){return moment(n.Helpers.convertToLocal(t)).format("HH:mm:ss")};this.correctAnswersCount=ko.computed(function(){return i.answers().filter(function(n){return n.correct}).length});this.incorrectAnswersCount=ko.computed(function(){return i.answers().filter(function(n){return!n.correct}).length});this.setData(t);this.toggle=function(){i.expanded(!i.expanded())}}return t}();t.LearningObjectiveForUserDetailsVM=i})(t=n.Pupils||(n.Pupils={}))}(SnappetChallenge||(SnappetChallenge={}));